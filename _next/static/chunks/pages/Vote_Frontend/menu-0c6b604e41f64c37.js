(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[452],{2325:function(a,b,c){(window.__NEXT_P=window.__NEXT_P||[]).push(["/Vote_Frontend/menu",function(){return c(3898)}])},3898:function(a,b,c){"use strict";c.r(b),c.d(b,{default:function(){return y}});var d=c(4111),e=c(1438),f=c(2951),g=c(4924),h=c(8029),i=c(797),j=c(460),k=c(5893),l=c(7294),m=c(5005),n=c(9583),o=c(6212),p=c(5147),q=function(a){var b=function(){},c=(0,l.useState)(!1),d=c[0],e=(c[1],(0,l.useState)(null)),f=e[0],g=(e[1],(0,l.useRef)(null)),h=(0,l.useState)(!1),i=h[0];h[1],(0,l.useEffect)(function(){return d||b(),function(){}},[d,a.show,g]);var j=function(){var a;null===(a=g.current)|| void 0===a||a.click()},n=function(){var a;null===(a=g.current)|| void 0===a||a.files};return(0,k.jsx)(l.Fragment,{children:(0,k.jsxs)(o.Z,{show:a.show,onHide:function(){a.setShow(!1)},size:"lg",children:[(0,k.jsx)(o.Z.Header,{children:(0,k.jsx)(o.Z.Title,{children:"Voter List"})}),(0,k.jsx)(o.Z.Body,{children:(0,k.jsxs)(p.Z,{striped:!0,hover:!0,size:"sm",style:{margin:"auto",padding:0},children:[(0,k.jsx)("thead",{children:(0,k.jsx)("tr",{children:f?f.headers.map(function(a,b){return(0,k.jsx)("th",{children:a},"header"+b)}):""})}),(0,k.jsx)("tbody",{children:f?f.lines.map(function(a,b){return(0,k.jsx)("tr",{children:a.map(function(a,b){return(0,k.jsx)("th",{children:a},"lines"+b)})},b+1)}):""})]})}),(0,k.jsx)(o.Z.Footer,{children:"admin"==a.role&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("input",{onChange:n,ref:g,className:"d-none",type:"file"}),(0,k.jsx)(m.Z,{onClick:j,style:{padding:10},variant:i?"success":"primary",children:i?"上傳成功":"上傳檔案"})]})})]})})},r=function(a){var b=(0,l.useState)(!1),c=b[0],d=b[1];return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(q,{role:a.role,show:c,setShow:d}),(0,k.jsx)("div",{className:"container-fluid",children:(0,k.jsx)("div",{className:"modal-dialog",children:(0,k.jsxs)("div",{className:"modal-content",children:[(0,k.jsx)("div",{className:"modal-header",style:{display:"inline-block"},children:(0,k.jsxs)("h3",{children:[a.number&&(0,k.jsx)("span",{className:"label",id:"qid",children:a.number}),a.title,(0,k.jsx)(m.Z,{size:"lg",variant:"success",onClick:function(){d(!c)},style:{float:"right",padding:3,marginTop:0,backgroundColor:"#45cc94"},children:(0,k.jsx)(n.I$,{})})]})}),(0,k.jsxs)("div",{className:"modal-body",children:[(0,k.jsx)("div",{className:"quiz",id:"quiz","data-toggle":"buttons",children:a.content}),a.footer]})]})})})]})},s=function(a){var b=function(){console.log("edit"),p(!0)},c=function(){console.log("save"),p(!1),a.handleUpdate(e,h,r,a.id)},d=(0,l.useState)(a.status),e=d[0],f=d[1],g=(0,l.useState)(a.qid),h=g[0],i=g[1],j=(0,l.useState)(!1),o=j[0],p=j[1],q=(0,l.useState)(a.text),r=q[0],s=q[1];return(0,l.useEffect)(function(){(e!=a.status||h!=a.qid)&&(console.log("props change!"),f(a.status),i(a.qid),s(a.text))}),(0,k.jsx)("div",{className:"d-grid",children:(0,k.jsxs)("label",{className:"btn btn-lg btn-primary btn-block ".concat(a.isSelected?"btn-success":""),id:a.id,onClick:function(){a.handleClick(a.id,r)},children:[(0,k.jsx)("span",{className:"btn-label",children:(0,k.jsx)(n.Dli,{})}),"admin"==a.role&& !1==a.voting?(0,k.jsx)("input",{type:"text",disabled:!o,value:r,onChange:function(a){s(a.target.value)},style:{backgroundColor:"#00000"},size:"25"}):(0,k.jsx)(k.Fragment,{children:a.text}),"admin"==a.role&& !1==a.voting?o?(0,k.jsx)(k.Fragment,{children:(0,k.jsx)(m.Z,{onClick:c,width:"sm",style:{padding:0,float:"right",backgroundColor:"transparent",border:"none"},children:(0,k.jsx)(n.l_A,{})})}):(0,k.jsx)(k.Fragment,{children:(0,k.jsx)(m.Z,{onClick:b,width:"sm",style:{padding:0,float:"right",backgroundColor:"transparent",border:"none"},children:(0,k.jsx)(n.tU3,{})})}):(0,k.jsx)(k.Fragment,{})]})})},t=function(a){var b=a.items.map(function(b,c){return(0,k.jsx)(s,{text:b,id:c,isSelected:a.selected.includes(c),handleClick:a.handleClick,status:a.status,role:a.role,qid:a.qid,handleUpdate:a.handleUpdate,voting:a.voting},c)});return(0,k.jsx)(l.Fragment,{children:b})},u=c(2304),v=c(2130),w={case:0,page:0,status:"start",answers_id:[],selected_id:[],votingData:{},shares:1,editing:!1},x=function(a){(0,h.Z)(c,a);var b=(0,j.Z)(c);function c(a){var f;return(0,e.Z)(this,c),f=b.call(this,a),(0,g.Z)((0,d.Z)(f),"handleCaseSelect",function(a,b){f.setState({case:a,selected_id:[a]})}),(0,g.Z)((0,d.Z)(f),"handleAnswerSelect",function(a,b){f.state.selected_id.includes(a)?f.setState({selected_id:f.state.selected_id.filter(function(b){return b!=a})}):f.setState({selected_id:(0,i.Z)(f.state.selected_id).concat([a])})}),(0,g.Z)((0,d.Z)(f),"handleStart",function(){f.setState({status:"voting",selected_id:[]})}),(0,g.Z)((0,d.Z)(f),"handleNext",function(){var a=f.state,b=a.page;b+1<a.votingData[f.state.case].content.length?f.setState({page:b+1,answers_id:(0,i.Z)(f.state.answers_id).concat([(0,i.Z)(f.state.selected_id)]),selected_id:[]}):(f.setState({page:0,status:"end",answers_id:(0,i.Z)(f.state.answers_id).concat([(0,i.Z)(f.state.selected_id)]),selected_id:[]}),console.log(f.state.answers_id))}),(0,g.Z)((0,d.Z)(f),"handleReset",function(){f.setState(w)}),(0,g.Z)((0,d.Z)(f),"handleUpdateVoteItem",function(a,b,c,d){var e=f.state.votingData;switch(a){case"start":try{var g=e.filter(function(a,b){return b==d})[0];g.title=c,f.setState({votingData:e.map(function(a,b){return b==d?g:a})})}catch(h){console.log(h)}break;case"voting":try{var i=e[f.state.case];i.content[b-1].answers[d].text=c,f.setState({votingData:e.map(function(a,b){return b==d?i:a})})}catch(j){console.log(j)}break;case"end":break;default:console.log("Unknown state.")}}),(0,g.Z)((0,d.Z)(f),"handleNewVoteCase",function(){var a=f.state.votingData;a.push({title:"",content:[{text:"",answers:[{text:"",count:0}]}]}),f.setState({votingData:a})}),(0,g.Z)((0,d.Z)(f),"handleNewVoteItem",function(){var a=f.state.votingData;a[f.state.case].content[0].answers.push({text:"",count:0}),f.setState({votingData:a})}),(0,g.Z)((0,d.Z)(f),"handleTally",function(){var a=f.state.votingData;f.props.handleTally(a),console.log("new data"),f.setState({votingData:f.state.original})}),(0,g.Z)((0,d.Z)(f),"handleVote",function(){var a=f.state.votingData;f.state.answers_id.forEach(function(b,c){b.forEach(function(b,d){a[f.state.case].content[c].answers[b].count+=1*f.state.shares})}),console.log(a),f.setState({votingData:a}),f.props.handleLogout()}),(0,g.Z)((0,d.Z)(f),"handleStartVoting",function(){f.props.handleStartVoting(),f.props.handleLogout()}),(0,g.Z)((0,d.Z)(f),"edit",function(){console.log("edit"),f.setState({editing:!0})}),(0,g.Z)((0,d.Z)(f),"save",function(){console.log("save"),f.setState({editing:!1})}),(0,g.Z)((0,d.Z)(f),"setText",function(){f.setState({text:!1})}),(0,g.Z)((0,d.Z)(f),"setCaseText",function(a){var b=f.state.votingData;b[f.state.case].content[f.state.page].text=a,f.setState({votingData:b})}),f.state=w,f.state.votingData=u,f}return(0,f.Z)(c,[{key:"render",value:function(){var a,b,c,d,e,f=this,g=this.state,h=g.status,i=g.answers_id,j=g.votingData,l=g.page,o=this.state.selected_id,p=this.context.role,q=this.context.voting;switch(h){case"start":a=!1,b="Ureka Voting Machine",e=j.map(function(a){return a.title}),c=(0,k.jsx)(t,{status:h,voting:q,qid:a,role:p,items:e,selected:o,handleClick:this.handleCaseSelect,handleUpdate:this.handleUpdateVoteItem}),d=(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(m.Z,{onClick:this.handleStart,children:"確認"}),"\xa0","admin"==p&&(0,k.jsx)(k.Fragment,{children:!1==this.context.voting?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(m.Z,{onClick:this.handleNewVoteCase,children:"新增議案"}),"\xa0",(0,k.jsx)(m.Z,{onClick:this.handleStartVoting,children:"開始投票"}),"\xa0"]}):(0,k.jsx)(m.Z,{onClick:this.handleTally,children:"開票"})})]});break;case"voting":a=l+1;var s=j[this.state.case].content[l],u=this.state.editing;b=(0,k.jsxs)(k.Fragment,{children:["admin"==this.context.role&& !1==this.context.voting?(0,k.jsx)("input",{type:"text",disabled:!u,value:s.text,onChange:function(a){f.setCaseText(a.target.value)},style:{backgroundColor:"#00000"},size:"28"}):(0,k.jsx)(k.Fragment,{children:s.text}),"admin"==this.context.role&& !1==this.context.voting?u?(0,k.jsx)(k.Fragment,{children:(0,k.jsx)(m.Z,{onClick:this.save,width:"sm",style:{padding:3,float:"",backgroundColor:"transparent",color:"grey",border:"none"},children:(0,k.jsx)(n.l_A,{})})}):(0,k.jsx)(k.Fragment,{children:(0,k.jsx)(m.Z,{onClick:this.edit,width:"sm",style:{padding:3,float:"",backgroundColor:"transparent",color:"grey",border:"none"},children:(0,k.jsx)(n.tU3,{})})}):(0,k.jsx)(k.Fragment,{})]}),e=s.answers.map(function(a){return a.text}),c=(0,k.jsx)(t,{status:h,voting:q,qid:a,role:p,items:e,selected:o,handleClick:this.handleAnswerSelect,handleUpdate:this.handleUpdateVoteItem}),d=(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(m.Z,{onClick:this.handleNext,children:"確認"}),"\xa0","admin"==p&& !1==this.props.voting&&(0,k.jsx)(m.Z,{onClick:this.handleNewVoteItem,children:"新增選項"})]});break;case"end":b="結束",c=i[0].map(function(a){return j[f.state.case].content[0].answers[a].text}),d="voter"==p?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(m.Z,{onClick:this.handleReset,children:"重新選擇"}),"\xa0",(0,k.jsx)(m.Z,{onClick:this.handleVote,children:"送出"}),"\xa0"]}):(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(m.Z,{onClick:this.props.handleLogout,children:"完成"}),"\xa0"]});break;default:console.log("Unknown state.")}return(0,k.jsx)(r,{status:h,role:p,number:a,title:b,content:c,footer:d})}}]),c}(l.Component);(0,g.Z)(x,"contextType",v.Z);var y=x}},function(a){a.O(0,[445,839,774,888,179],function(){var b;return a(a.s=2325)}),_N_E=a.O()}])